# üìÖ Daily Log - 03-08-2025

## üéØ Today's Focus
*Main goal for today was to complete the Express JS Advanced exercise in my learning plan, where I was Learning MERN stack  quick and fast with production ready efficiency*

## ‚úÖ What I Accomplished
*Today I learned how to make a middleware using Express.Js to check if a user was admin or not*

- [x] POST /login: A public route for any user to get a token.
- [x] GET /profile: A route protected by one middleware (authenticateToken) that any authenticated user can access.
- [x] GET /admin: A route protected by two middleware functions (authenticateToken and checkAdmin) that only an authenticated admin can access.

## üß† What I Learned
- *I failed to implement the conditional logic specified in the exercise. The requirement was to grant isAdmin: true only if a user logs in with the username 'admin'. My code in the /register route assigns isAdmin: true to every single user, creating a massive security vulnerability where any registered user becomes an administrator.*
- *Minor Improvement: Defensive Middleware
My checkAdmin middleware assumes req.user will always exist. While it works in my current chain, a more robust and defensive way to write it is to check for the existence of req.user first, like so: if (req.user && req.user.isAdmin). This prevents errors if the middleware is ever accidentally used without authenticateToken preceding it.*

### Technical Learnings
- **Middleware**: Functions that intercept the req/res cycle in Express. They are used for logging, parsing request bodies (express.json), validation, and authentication. They either pass control to the next function with next() or terminate the cycle by sending a response.
- **Dynamic Routing**:Creating routes that accept parameters from the URL (e.g., /users/:id). These parameters are available as strings in the req.params object and often require parsing (e.g., parseInt).
-  **JWT Authentication**:A stateless method for securing endpoints. A token is created (jwt.sign) on login and sent to the client. The client sends the token back in the Authorization header on subsequent requests. The server verifies it (jwt.verify) in a middleware.
-  **Role-Based Access Control (RBAC)**:An extension of authentication, implemented by chaining middleware. After a user is authenticated, a second middleware can check for specific roles or permissions (e.g., isAdmin: true) in the JWT payload to authorize access to restricted routes.

### Process Improvements
- **Insight**:Middleware allows for the separation of concerns. Logic for authentication, logging, and validation can be kept separate from the core business logic in the route handlers, leading to cleaner, more modular, and reusable code.
- **Insight**: Using a stateless authentication mechanism like JWT improves scalability. The server does not need to maintain a session store, meaning any server instance can handle any authenticated request as long as it has the secret key.

## üöß Challenges & Blockers
*What slowed you down or caused frustration?*

### Technical Challenges
- **Issue**: Dynamic route parameters (e.g., req.params.id) are strings, which caused strict equality checks (===) against number IDs in the data to fail.
- **Solution**: Always parse string parameters to the correct data type (e.g., parseInt(req.params.id, 10)) before performing comparisons.
- **Issue**: Forgetting to implement conditional logic in the /login route, which resulted in granting admin privileges to every user.
- **Solution**:Carefully implement business rules specified in the requirements, such as checking for a specific username before assigning roles in a JWT payload.
- **Issue**:Using an insecure and unprofessional JWT_SECRET and hardcoding it.
- **Solution**:Understand that secrets must be high-entropy random strings managed via environment variables, never hardcoded.
  
### Process Challenges
- **Issue**: Viewing the need to consult official documentation as a failure or "cheating," which led to being stuck.
- **Solution**: Re-framing documentation as a primary, required tool for professional problem-solving. The protocol demands using external resources to bridge the gap between concept and implementation.
- **Issue**:A desire to skip a core module (JWT) due to perceived difficulty.
- **Solution**:Acknowledging that foundational topics like security are non-negotiable and must be mastered, not avoided. Breaking the problem down into smaller, incremental steps to overcome the block.
## üîç Code Snippets & Solutions
*Code of Todays learning*

```Javascript
const express = require("express");
const jwt = require("jsonwebtoken");

// THIS MUST BE a long, random string from an environment variable in a real app.
const JWT_SECRET = process.env.JWT_SECRET || 'a-very-long-and-secure-random-string-for-dev';

const app = express();
const port = 8000;
app.use(express.json());

// --- Middleware ---
const authenticateToken = (req, res, next) => {
    const authHeader = req.headers["authorization"];
    const token = authHeader && authHeader.split(" ")[1];
    if (token == null) {
        return res.status(401).json({ error: "Authorization token required" });
    }

    jwt.verify(token, JWT_SECRET, (err, user) => {
        if (err) {
            return res.status(403).json({ error: "Token is not valid or has expired" });
        }
        req.user = user;
        next();
    });
};

const checkAdmin = (req, res, next) => {
    // Defensive check
    if (req.user && req.user.isAdmin) {
        next();
    } else {
        return res.status(403).json({ "error": "Access denied. Admin role required." });
    }
};

// --- Routes ---
app.post("/login", (req, res) => {
    const { username } = req.body;
    if (!username) {
        return res.status(400).json({ error: 'Username is required' });
    }

    // Correctly implement the conditional admin logic
    const userPayload = {
        id: username === 'admin' ? 1 : 2, // Example user IDs
        name: username,
        isAdmin: username === 'admin' // Grant admin only if username is 'admin'
    };

    const token = jwt.sign(userPayload, JWT_SECRET, { expiresIn: "1h" });
    res.json({ token: token });
});

app.get("/admin", authenticateToken, checkAdmin, (req, res) => {
    res.json({
        message: `Welcome, Admin ${req.user.name}! You have accessed the admin-only area.`
    });
});

app.listen(port, () => {
    console.log(`Server listening at http://localhost:${port}`);
});
```

## üìö Resources & References
*Links, articles, or tools that helped you today*

- [Express.js Middleware Guide ](https://expressjs.com/en/guide/using-middleware.html) - Official documentation on how to write and use middleware functions.
- [jsonwebtoken (NPM)](https://www.npmjs.com/package/jsonwebtoken) - The primary documentation for the jsonwebtoken library, detailing the sign() and verify() methods and their options.

## üéØ Tomorrow's Plan
*What will you focus on tomorrow?*

- [ ] Set up a free MongoDB Atlas cluster and install the MongoDB Compass GUI.
- [ ] Learn core MongoDB concepts: Databases, Collections, Documents, and basic CRUD (Create, Read, Update, Delete) operations.
- [ ] Connect the Express application to the MongoDB database using the Mongoose ODM (Object Data Modeling) library.

## üí≠ Reflection
*How do you feel about today's progress? What could you do better?*

*Today was challenging but foundational. The initial frustration with middleware and JWT highlighted a critical shift in mindset: moving from academic learning to professional problem-solving.

The primary bottleneck wasn't the code's complexity but the initial resistance to using documentation as a primary tool. Debugging issues like the parseInt requirement for route params and the conditional isAdmin logic proved that meticulous attention to specifications and data types is non-negotiable.

The key takeaway is that difficult exercises are not blockers; they are designed to force the development of research skills. The goal moving forward is to embrace documentation immediately and view complex problems as an expected part of the engineering process.

While I did make those codes, I need more practice to get familiar with writing those stuff on own with ease
*

---

**Time Spent**: 1 hours  
**Energy Level**: ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê  
**Satisfaction**: ‚≠ê‚≠ê‚≠ê‚≠ê 